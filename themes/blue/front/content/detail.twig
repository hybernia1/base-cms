{% extends 'front/layout.twig' %}

{% block title %}
    {% if item %}{{ item.title }} | {{ type.name|default('Obsah') }}{% else %}Nenalezeno{% endif %}
{% endblock %}

{% block head_extra %}
    {% set description = (item.excerpt ?: (item.body|default('')|striptags|slice(0, 240))) %}
    {% if description %}
        <meta name="description" content="{{ description|striptags }}">
    {% endif %}

    {% set og_image = thumbnail ? base_url ~ '/' ~ thumbnail.path ~ '/' ~ (thumbnail.webp_filename ?: thumbnail.filename) : null %}
    {% if current_url is defined %}
        <meta property="og:url" content="{{ current_url }}">
        <meta property="og:type" content="article">
    {% endif %}
    <meta property="og:title" content="{{ item.title }}">
    {% if description %}<meta property="og:description" content="{{ description|striptags }}">{% endif %}
    {% if og_image %}<meta property="og:image" content="{{ og_image }}">{% endif %}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ item.title }}">
    {% if description %}<meta name="twitter:description" content="{{ description|striptags }}">{% endif %}
    {% if og_image %}<meta name="twitter:image" content="{{ og_image }}">{% endif %}

    {% set schema_data = {
        '@context': 'https://schema.org',
        '@type': item.schema_type|default('Article'),
        'headline': item.title,
        'description': description,
        'datePublished': item.publish_at is defined and item.publish_at ? item.publish_at|date('c') : null,
        'dateModified': item.updated_at is defined and item.updated_at ? item.updated_at|date('c') : null,
        'author': author ? {'@type': 'Person', 'name': author.nickname} : null,
        'image': og_image,
        'mainEntityOfPage': current_url,
        'url': current_url,
        'publisher': site.name is defined ? {'@type': 'Organization', 'name': site.name} : null
    } %}
    <script type="application/ld+json">{{ schema_data|json_encode(constant('JSON_UNESCAPED_UNICODE') b-or constant('JSON_UNESCAPED_SLASHES'))|raw }}</script>
{% endblock %}

{% block body %}
    <div class="row justify-content-center">
        <div class="col-12 col-lg-11">
            {% if not item %}
                <div class="alert alert-warning mt-4">Obsah nebyl nalezen.</div>
            {% else %}
                <article class="article-shell shadow-sm border-0 mt-4">
                    {% if thumbnail %}
                        <img src="/{{ thumbnail.path }}/{{ thumbnail.webp_filename ?: thumbnail.filename }}" class="card-img-top" alt="{{ thumbnail.alt ?: item.title }}" loading="lazy" decoding="async">
                    {% endif %}
                    <div class="card-body p-3 p-md-4">
                        <div class="text-muted d-flex flex-wrap gap-2 small mb-2 align-items-center">
                            <span class="d-inline-flex align-items-center gap-1">
                                <i class="bi bi-calendar-event" aria-hidden="true"></i>
                                {{ item.created_at|date('j. n. Y') }}
                            </span>
                            <span class="d-inline-flex align-items-center gap-1">
                                <i class="bi bi-journal-text" aria-hidden="true"></i>
                                {{ type.name|default(type.slug|default('Obsah')) }}
                            </span>
                            {% if author %}
                                <span class="d-inline-flex align-items-center gap-1">
                                    <i class="bi bi-person" aria-hidden="true"></i>
                                    {% if author.profile_url %}
                                        <a href="{{ author.profile_url }}" class="text-decoration-none">{{ author.nickname }}</a>
                                    {% else %}
                                        {{ author.nickname }}
                                    {% endif %}
                                </span>
                            {% endif %}
                        </div>
                        <h1 class="card-title">{{ item.title }}</h1>
                        {% if terms %}
                            <div class="mb-3 d-flex flex-wrap gap-2">
                                {% for term in terms %}
                                    <a href="/terms/{{ term.type }}/{{ term.slug }}" class="badge text-bg-light border text-decoration-none">{{ term.name }}</a>
                                {% endfor %}
                            </div>
                        {% endif %}
                        {% if item.excerpt %}
                            <p class="lead">{{ item.excerpt }}</p>
                        {% endif %}
                        <div class="content-body">
                            {{ (rendered_body ?? item.body)|raw }}
                        </div>
                        {% if meta_values %}
                            <div class="mt-4">
                                <h2 class="h6 mb-3">Meta Ãºdaje</h2>
                                <dl class="row g-3">
                                    {% for key, value in meta_values %}
                                        <dt class="col-sm-4 text-muted">{{ meta_definitions[key].name|default(key) }}</dt>
                                        <dd class="col-sm-8 mb-0">{{ value }}</dd>
                                    {% endfor %}
                                </dl>
                            </div>
                        {% endif %}
                    </div>
                </article>

                {% if comment_allowed %}
                    <div class="mt-4">
                        <a class="btn btn-outline-primary" href="/{{ type.slug }}/{{ item.slug }}/comments">
                            Vstoupit do diskuse ({{ comments|length }})
                        </a>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ parent() }}
{% endblock %}

