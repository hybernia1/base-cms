{% import 'admin/partials/components.twig' as ui %}

{% set df = app_settings.date_format|default('d.m.Y') %}
{% set tf = app_settings.time_format|default('H:i') %}

<form method="get"
      action="/admin/content/{{ current_type.slug }}"
      class="mb-3"
      data-ajax-form>
    <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="text" name="q" value="{{ search|default('') }}" class="form-control" placeholder="Hledat v názvu, slugu nebo textu">
        {% if current_status and current_status != 'all' %}
            <input type="hidden" name="status" value="{{ current_status }}">
        {% endif %}
        <button class="btn btn-outline-secondary" type="submit">Vyhledat</button>
    </div>
</form>

<ul class="nav nav-pills mb-3">
    <li class="nav-item">
        <a class="nav-link {% if current_status == 'published' %}active{% endif %}"
           href="/admin/content/{{ current_type.slug }}?status=published{% if search is not empty %}&amp;q={{ search|url_encode }}{% endif %}">
            Publikované
            <span class="badge text-bg-light ms-1">{{ counts.published|default(0) }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if current_status == 'draft' %}active{% endif %}"
           href="/admin/content/{{ current_type.slug }}?status=draft{% if search is not empty %}&amp;q={{ search|url_encode }}{% endif %}">
            Koncepty
            <span class="badge text-bg-light ms-1">{{ counts.draft|default(0) }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if current_status == 'trash' %}active{% endif %}"
           href="/admin/content/{{ current_type.slug }}?status=trash{% if search is not empty %}&amp;q={{ search|url_encode }}{% endif %}">
            Koš
            <span class="badge text-bg-light ms-1">{{ counts.trash|default(0) }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if current_status not in ['published','draft','trash'] %}active{% endif %}"
           href="/admin/content/{{ current_type.slug }}{% if search is not empty %}?q={{ search|url_encode }}{% endif %}">
            Vše
            <span class="badge text-bg-light ms-1">{{ counts.all|default(0) }}</span>
        </a>
    </li>
</ul>

{% if items is empty %}
    <div class="alert alert-info">
        {% if current_status == 'published' %}
            Zatím zde není žádný publikovaný obsah.
        {% elseif current_status == 'draft' %}
            Zatím zde nejsou žádné koncepty.
        {% elseif current_status == 'trash' %}
            Koš je prázdný.
        {% else %}
            Zatím zde není žádný obsah.
        {% endif %}
    </div>
{% else %}
    <div class="table-responsive">
        <table class="table align-middle">
            <thead>
                <tr>
                    <th>Název</th>
                    <th>Upraveno</th>
                    <th class="text-end">Akce</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                    <tr>
                        <td class="fw-semibold">
                            {# Stav + Titulek #}
                            <div class="d-flex align-items-center gap-2">
                                {% if item.status == 'published' %}
                                    <i class="bi bi-check-circle-fill text-success" aria-hidden="true"></i>
                                    <span class="visually-hidden">Publikovaný obsah</span>
                                {% else %}
                                    <i class="bi bi-pencil-fill text-secondary" aria-hidden="true"></i>
                                    <span class="visually-hidden">Koncept</span>
                                {% endif %}
                                <span>{{ item.title }}</span>
                            </div>

                            {# Slug pod tím #}
                            <div class="small text-muted mt-1">
                                <code>{{ item.slug }}</code>
                            </div>
                        </td>

                        <td>    {% if item.updated_at is not empty %}
        {{ item.updated_at|date(df ~ ' ' ~ tf) }}
    {% endif %}</td>

        <td class="text-end">
            {% set deleteConfirm = current_status == 'trash'
                ? 'Opravdu nenávratně smazat tento obsah?'
                : 'Přesunout obsah do koše?'
            %}

            {% set extraActions = [] %}
            {% if current_status == 'trash' %}
                {% set extraActions = extraActions|merge([{
                    type: 'form',
                    action: '/admin/content/' ~ current_type.slug ~ '/' ~ item.id ~ '/restore',
                    variant: 'success',
                    icon: 'bi-arrow-counterclockwise',
                    ajax: true,
                    hidden: { redirect: pagination.current_url },
                    confirm: 'Obnovit tento obsah?'
                }]) %}
            {% endif %}

            {{ ui.crud_actions('/admin/content/' ~ current_type.slug ~ '/' ~ item.id, {
                delete: {
                    confirm: deleteConfirm,
                    ajax: true,
                    hidden: { redirect: pagination.current_url },
                    variant: 'danger',
                    icon: current_status == 'trash' ? 'bi-trash3' : 'bi-trash'
                },
                extra: extraActions
            }) }}
        </td>
    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {{ ui.pagination(pagination) }}
{% endif %}
