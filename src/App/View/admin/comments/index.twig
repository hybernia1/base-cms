{% extends 'admin/layout.twig' %}

{% set current_menu = 'comments' %}
{% block title %}Komentáře | Administrace{% endblock %}

{% block body %}
    <div class="d-flex align-items-center mb-3">
        <h1 class="h4 mb-0">Komentáře</h1>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-4">
            <div class="mb-3">
                <div class="nav nav-pills gap-2">
                    {% set tabs = {
                        'all': 'Vše',
                        'pending': 'Čeká na schválení',
                        'approved': 'Schválené'
                    } %}
                    {% for key, label in tabs %}
                        <a href="/admin/comments?status={{ key }}" class="btn btn-sm {% if status == key %}btn-primary{% else %}btn-outline-primary{% endif %}">
                            {{ label }}
                            <span class="badge text-bg-light ms-1">{{ counts[key]|default(0) }}</span>
                        </a>
                    {% endfor %}
                </div>
            </div>

            {% if comments is empty %}
                <p class="text-muted mb-0">Žádné komentáře pro zvolený filtr.</p>
            {% else %}
                <div class="table-responsive">
                    <table class="table align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Autor</th>
                                <th>Text</th>
                                <th>Obsah</th>
                                <th>Stav</th>
                                <th class="text-end">Akce</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for comment in comments %}
                                <tr>
                                    <td>
                                        <div class="fw-semibold">{{ comment.author_name ?: 'Anonym' }}</div>
                                        <div class="text-muted small">{{ comment.author_email }}</div>
                                        <div class="text-muted small">{{ comment.created_at|date('j. n. Y H:i') }}</div>
                                    </td>
                                    <td>{{ comment.body|slice(0, 180) }}{% if comment.body|length > 180 %}…{% endif %}</td>
                                    <td class="text-muted small">
                                        {% set content = content_map[comment.content_id]|default(null) %}
                                        {% if content %}
                                            <div class="fw-semibold">{{ content.title }}</div>
                                            <div>{{ content.type }}</div>
                                        {% else %}
                                            <em>Nenalezeno</em>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if comment.status == 'approved' %}
                                            <span class="badge bg-success-subtle text-success">Schváleno</span>
                                        {% else %}
                                            <span class="badge bg-warning-subtle text-warning">Čeká</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">
                                        <a href="/admin/comments/{{ comment.id }}/edit" class="btn btn-sm btn-outline-secondary">Detail</a>
                                        {% if comment.status != 'approved' %}
                                            <form method="post" action="/admin/comments/{{ comment.id }}/approve" class="d-inline ms-2">
                                                <button type="submit" class="btn btn-sm btn-success">Schválit</button>
                                            </form>
                                        {% endif %}
                                        <form method="post" action="/admin/comments/{{ comment.id }}/delete" class="d-inline ms-2">
                                            <button type="submit" class="btn btn-sm btn-outline-danger">Smazat</button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

