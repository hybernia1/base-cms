{% import 'admin/partials/components.twig' as ui %}

{{ ui.search_form('/admin/terms/type/' ~ current_term_type.key, {
    query: search|default(''),
    placeholder: 'Hledat podle názvu nebo slugu',
    ajax: true
}) }}

{% if items is empty %}
    <div class="alert alert-info">Zatím zde nejsou žádné termy.</div>
{% else %}
    <div class="d-flex justify-content-end mb-2">
        <button type="submit"
                class="btn btn-outline-danger btn-sm"
                form="bulkTermsForm"
                data-confirm="Opravdu smazat vybrané termy?"
                data-confirm-title="Trvalé smazání">
            <i class="bi bi-check2-square me-1"></i>Smazat vybrané
        </button>
    </div>

    <form id="bulkTermsForm" action="/admin/terms/bulk-delete" method="post">
        <input type="hidden" name="redirect" value="{{ pagination.current_url }}">
        <input type="hidden" name="type" value="{{ current_term_type.key }}">
    </form>

    <div class="table-responsive">
        <table class="table align-middle">
            <thead>
                <tr>
                    <th class="text-center" style="width: 40px;">
                        <input type="checkbox" class="form-check-input" data-check-all="#bulkTermsForm .js-bulk-item">
                    </th>
                    <th>Název</th>
                    <th>Typy obsahu</th>
                    <th class="text-end">Akce</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                    <tr>
                        <td class="text-center">
                            <input type="checkbox" class="form-check-input js-bulk-item" form="bulkTermsForm" name="ids[]" value="{{ item.id }}" aria-label="Vybrat term">
                        </td>
                        <td class="fw-semibold">

                            {# název #}
                            {{ item.name }}

                            {# slug pod názvem #}
                            <div class="text-muted small mt-1">
                                <code>{{ item.slug }}</code>
                            </div>

                        </td>

                        <td>
                            {% if item.allowed_for is iterable and item.allowed_for|length > 0 %}
                                {% for typeKey in item.allowed_for %}
                                    <span class="badge text-bg-light text-body border">
                                        {{ content_types[typeKey].name|default(typeKey) }}
                                    </span>
                                {% endfor %}
                            {% else %}
                                <span class="text-muted small">Vše</span>
                            {% endif %}
                        </td>

                        <td class="text-end">
                            {{ ui.crud_actions('/admin/terms/' ~ item.id, {
                                delete: {
                                    confirm: 'Opravdu smazat tento term?',
                                    ajax: true,
                                    hidden: {
                                        redirect: pagination.current_url,
                                        type: current_term_type ? current_term_type.key : item.type,
                                    }
                                }
                            }) }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {{ ui.pagination(pagination) }}

{% endif %}
