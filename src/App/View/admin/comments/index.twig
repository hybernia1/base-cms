{% extends 'admin/layout.twig' %}

{% set current_menu = 'comments' %}
{% block title %}Komentáře | Administrace{% endblock %}

{% block body %}
    <div class="d-flex align-items-center mb-3">
        <h1 class="h4 mb-0">Komentáře</h1>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-4">
            {% if pending_comments is empty %}
                <p class="text-muted mb-0">Zatím zde nejsou žádné komentáře ke schválení.</p>
            {% else %}
                <div class="table-responsive">
                    <table class="table align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Autor</th>
                                <th>Text</th>
                                <th>Obsah</th>
                                <th class="text-end">Akce</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for comment in pending_comments %}
                                <tr>
                                    <td>
                                        <div class="fw-semibold">{{ comment.author_name ?: 'Anonym' }}</div>
                                        <div class="text-muted small">{{ comment.author_email }}</div>
                                        <div class="text-muted small">{{ comment.created_at|date('j. n. Y H:i') }}</div>
                                    </td>
                                    <td>{{ comment.body|slice(0, 180) }}{% if comment.body|length > 180 %}…{% endif %}</td>
                                    <td class="text-muted small">
                                        {% set content = content_map[comment.content_id]|default(null) %}
                                        {% if content %}
                                            <div class="fw-semibold">{{ content.title }}</div>
                                            <div>{{ content.type }}</div>
                                        {% else %}
                                            <em>Nenalezeno</em>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">
                                        <form method="post" action="/admin/comments/{{ comment.id }}/approve" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-success">Schválit</button>
                                        </form>
                                        <form method="post" action="/admin/comments/{{ comment.id }}/delete" class="d-inline ms-2">
                                            <button type="submit" class="btn btn-sm btn-outline-danger">Smazat</button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

