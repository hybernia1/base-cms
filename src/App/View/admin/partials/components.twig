{% macro pagination(pagination) %}
    {% if pagination.pages > 1 %}
        <nav aria-label="Stránkování" class="mt-3">
            <ul class="pagination pagination-sm justify-content-center pagination-soft">
                <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link d-flex align-items-center gap-2" href="{{ pagination.prev_url ?: '#' }}" aria-label="Předchozí">
                        <i class="bi bi-chevron-left"></i>
                        <span class="d-none d-md-inline">Předchozí</span>
                    </a>
                </li>

                {% for page in pagination.page_numbers %}
                    <li class="page-item {% if page == pagination.page %}active{% endif %}">
                        <a class="page-link fw-semibold" href="{{ pagination.page_urls[page] ?? '#' }}">{{ page }}</a>
                    </li>
                {% endfor %}

                <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                    <a class="page-link d-flex align-items-center gap-2" href="{{ pagination.next_url ?: '#' }}" aria-label="Další">
                        <span class="d-none d-md-inline">Další</span>
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    {% endif %}
{% endmacro %}

{% macro page_header(title, actions = [], heading_class = 'h3') %}
    <div class="page-header">
        <h1 class="{{ heading_class }} mb-0">{{ title }}</h1>
        {% if actions is not empty %}
            <div class="page-header-actions">
                {% for action in actions %}
                    {% set tooltip = action.title ?: action.label %}
                    {% if action.type|default('link') == 'link' %}
                        <a href="{{ action.href }}"
                           class="btn btn-{{ action.variant|default('primary') }}"
                           title="{{ tooltip }}">
                            {% if action.icon %}<i class="bi {{ action.icon }} me-1"></i>{% endif %}{{ action.label }}
                        </a>
                    {% elseif action.type == 'button' %}
                        <button type="{{ action.button_type|default('button') }}"
                                class="btn btn-{{ action.variant|default('primary') }}"
                                {% if action.attributes is defined %}{% for name, value in action.attributes %} {{ name }}="{{ value }}"{% endfor %}{% endif %}
                                title="{{ tooltip }}">
                            {% if action.icon %}<i class="bi {{ action.icon }} me-1"></i>{% endif %}{{ action.label }}
                        </button>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro actions(actions, size = 'sm') %}
    {% set size_class = size ? 'btn-group-' ~ size : '' %}
    <div class="btn-group {{ size_class }}" role="group">
        {% for action in actions %}
            {% set tooltip = action.title ?: action.label %}

            {% if action.type == 'link' %}
                <a href="{{ action.href }}"
                   class="btn btn-outline-{{ action.variant|default('secondary') }} btn-icon"
                   title="{{ tooltip }}"
                   aria-label="{{ tooltip }}"
                   {% if action.attributes is defined %}{% for name, value in action.attributes %} {{ name }}="{{ value }}"{% endfor %}{% endif %}>
                    {% if action.icon %}<i class="bi {{ action.icon }}"></i>{% endif %}
                </a>

            {% elseif action.type == 'form' %}
                <form method="{{ action.method|default('post') }}"
                      action="{{ action.action }}"
                      class="d-inline"
                      {% if action.ajax %}data-ajax-delete="1"{% endif %}
                      {% if action.confirm %}data-confirm="{{ action.confirm }}"{% endif %}
                      {% if action.attributes is defined %}{% for name, value in action.attributes %} {{ name }}="{{ value }}"{% endfor %}{% endif %}>

                    {% if action.hidden is defined %}
                        {% for name, value in action.hidden %}
                            <input type="hidden" name="{{ name }}" value="{{ value }}">
                        {% endfor %}
                    {% endif %}

                    <button type="submit"
                            class="btn btn-outline-{{ action.variant|default('secondary') }} btn-icon"
                            title="{{ tooltip }}"
                            aria-label="{{ tooltip }}">
                        {% if action.icon %}<i class="bi {{ action.icon }}"></i>{% endif %}
                    </button>
                </form>

            {% elseif action.type == 'button' %}
                <button type="{{ action.button_type|default('button') }}"
                        class="btn btn-outline-{{ action.variant|default('secondary') }} btn-icon"
                        title="{{ tooltip }}"
                        aria-label="{{ tooltip }}"
                        {% if action.form %}form="{{ action.form }}"{% endif %}
                        {% if action.confirm %}data-confirm="{{ action.confirm }}"{% endif %}
                        {% if action.attributes is defined %}{% for name, value in action.attributes %} {{ name }}="{{ value }}"{% endfor %}{% endif %}>
                    {% if action.icon %}<i class="bi {{ action.icon }}"></i>{% endif %}
                </button>
            {% endif %}
        {% endfor %}
    </div>
{% endmacro %}

{% macro back_button(href, options = {}) %}
    {% set label = options.label|default('Zpět') %}
    {% set icon = options.icon|default('bi-arrow-left') %}
    {% set variant = options.variant|default('secondary') %}
    {% set size = options.size|default('sm') %}

    <a href="{{ href }}"
       class="btn btn-outline-{{ variant }} btn-icon btn-{{ size }}"
       title="{{ label }}"
       aria-label="{{ label }}">
        <i class="bi {{ icon }}"></i>
    </a>
{% endmacro %}

{% macro view_button(href, options = {}) %}
    {% set label = options.label|default('Zobrazit') %}
    {% set variant = options.variant|default('primary') %}
    {% set icon = options.icon|default('bi-box-arrow-up-right') %}
    {% set block = options.block|default(false) %}
    {% set disabled = options.disabled|default(false) %}
    {% set target = options.target|default('_self') %}
    {% set extra_classes = options.class|default('') %}

    {% set base_classes = [
        'btn',
        'btn-outline-' ~ variant,
        block ? 'w-100' : 'btn-icon',
        disabled ? 'disabled' : '',
        extra_classes
    ] %}

    <a
        href="{{ disabled ? '#' : href }}"
        class="{{ base_classes|join(' ')|trim }}"
        {% if not disabled %}target="{{ target }}"{% endif %}
        title="{{ label }}"
        aria-label="{{ label }}"
        {% if disabled %}aria-disabled="true"{% endif %}
    >
        {% if icon %}<i class="bi {{ icon }}"></i>{% endif %}{% if block %}<span class="ms-2">{{ label }}</span>{% endif %}
    </a>
{% endmacro %}

{% macro crud_actions(base, options = {}) %}
    {% set actions = [] %}

    {% if options.edit is not same as(false) %}
        {% set edit = options.edit|default({}) %}
        {% set actions = actions|merge([{
            type: 'link',
            href: edit.href|default(base ~ '/edit'),
            label: edit.label|default('Upravit'),
            variant: edit.variant|default('primary'),
            icon: edit.icon|default('bi-pencil')
        }]) %}
    {% endif %}

    {% if options.delete is not same as(false) %}
        {% set del = options.delete|default({}) %}
        {% set actions = actions|merge([{
            type: 'form',
            action: del.action|default(base ~ '/delete'),
            label: del.label|default('Smazat'),
            variant: del.variant|default('danger'),
            icon: del.icon|default('bi-trash'),
            confirm: del.confirm|default('Opravdu smazat?'),
            ajax: del.ajax|default(false),
            hidden: del.hidden|default({})
        }]) %}
    {% endif %}

    {% if options.extra is defined %}
        {% set actions = actions|merge(options.extra) %}
    {% endif %}

{{ _self.actions(actions, options.size|default('sm')) }}
{% endmacro %}

{% macro search_form(action, options = {}) %}
    {% set method = options.method|default('get') %}
    {% set query = options.query|default('') %}
    {% set placeholder = options.placeholder|default('Hledat') %}
    {% set hidden = options.hidden|default({}) %}
    {% set ajax = options.ajax|default(false) %}
    {% set button_label = options.button_label|default('Vyhledat') %}
    {% set extra_classes = options.class|default('mb-3') %}
    {% set name = options.name|default('q') %}

    <form method="{{ method }}" action="{{ action }}" class="{{ extra_classes }}" {% if ajax %}data-ajax-form{% endif %}>
        <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" name="{{ name }}" value="{{ query }}" class="form-control" placeholder="{{ placeholder }}">

            {% if hidden is not empty %}
                {% for hiddenName, value in hidden %}
                    <input type="hidden" name="{{ hiddenName }}" value="{{ value }}">
                {% endfor %}
            {% endif %}

            <button class="btn btn-outline-secondary" type="submit">{{ button_label }}</button>
        </div>
    </form>
{% endmacro %}

{% macro status_tabs(baseUrl, tabs, current, queryParams = {}) %}
    <ul class="nav nav-pills mb-3">
        {% for tab in tabs %}
            {% set tabParams = queryParams %}
            {% if tab.status is defined %}
                {% set tabParams = tabParams|merge({ status: tab.status }) %}
            {% endif %}
            {% if tab.params is defined %}
                {% set tabParams = tabParams|merge(tab.params) %}
            {% endif %}

            {% set queryString = [] %}
            {% for name, value in tabParams %}
                {% if value is not same as(null) and value is not same as('') %}
                    {% set queryString = queryString|merge([name ~ '=' ~ value|url_encode]) %}
                {% endif %}
            {% endfor %}

            {% set url = baseUrl ~ (queryString ? '?' ~ queryString|join('&') : '') %}

            {% set isActive = false %}
            {% if tab.status is defined and current == tab.status %}
                {% set isActive = true %}
            {% elseif tab.is_default|default(false) and (current is empty or current == 'all') %}
                {% set isActive = true %}
            {% endif %}

            <li class="nav-item">
                <a class="nav-link {% if isActive %}active{% endif %}" href="{{ url }}">
                    {{ tab.label }}
                    {% if tab.count is defined %}
                        <span class="badge text-bg-light ms-1">{{ tab.count }}</span>
                    {% endif %}
                </a>
            </li>
        {% endfor %}
    </ul>
{% endmacro %}
